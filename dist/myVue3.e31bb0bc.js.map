{"version":3,"sources":["Binding.js","Watcher.js","Compile.js","myVue.js","index.js"],"names":["Binding","subs","sub","key","trim","push","filter","item","forEach","update","Watcher","node","attr","data","Compile","el","vm","_data","root","document","querySelector","nodes","childNodes","binding","compile","Array","from","type","nodeType","text","textContent","compileText","children","length","hasAttribute","tagName","addEventListener","getAttribute","addSub","removeAttribute","value","methods","$options","method","bind","txt","reg","valueArr","test","innerHTML","replace","matched","split","v","val","i","tArr","index","myVue3","options","observe","call","that","Proxy","get","target","prop","Reflect","set","result","count","other","changeCount","console","log","changeOther"],"mappings":"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","file":"myVue3.e31bb0bc.js","sourceRoot":"..","sourcesContent":["// 观察者队列\r\n\r\nclass Binding {\r\n    // 初始化\r\n    constructor() {\r\n        this.subs = {};\r\n    }\r\n    // 增加订阅\r\n    addSub(sub) {\r\n        if (sub.key) this.subs[sub.key.trim()] = [];\r\n        this.subs[sub.key.trim()].push(sub)\r\n    }\r\n    // 通知事件\r\n    notify() {\r\n        this.subs.filter((item) => typeof item !== 'string').forEach((sub) => {\r\n            sub.update()\r\n        })\r\n    }\r\n}\r\n\r\nexport default Binding;","// 发布订阅队列\r\n\r\nclass Watcher {\r\n    constructor(node, attr, data, key) {\r\n        this.node = node\r\n        this.attr = attr\r\n        this.data = data\r\n        this.key = key\r\n    }\r\n    update() {\r\n        this.node[this.attr] = this.data[this.key]\r\n    }\r\n}\r\n\r\nexport default Watcher","// 编译 HTML 元素\r\nimport Watcher from './Watcher'\r\n\r\nclass Compile {\r\n    constructor(el, vm) {\r\n        // 取已做好拦截操作的数据源\r\n        this.data = vm._data;\r\n        // 获取根节点\r\n        let root = this.root = document.querySelector(el);\r\n        // 获取根节点下所有子节点集合\r\n        let nodes = root.childNodes;\r\n        this.nodes = nodes;\r\n        // 存储全局 this\r\n        this.vm = vm;\r\n        // 订阅列表\r\n        this.binding = vm.binding;\r\n        // 开始编译\r\n        this.compile(nodes);\r\n    }\r\n    // 编译函数\r\n    compile(nodes) {\r\n        let vm = this.vm;\r\n        let data = vm._data;\r\n        // 遍历子节点\r\n        Array.from(nodes).forEach(node => {\r\n            // 获取节点类型\r\n            // 1: 元素节点  3： 内容节点\r\n            // https://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType\r\n            let type = node.nodeType;\r\n\r\n            // 文字节点\r\n            if (type === 3) {\r\n                let text = node.textContent.trim();\r\n                if (!text) return true;\r\n                this.compileText(node, 'textContent')\r\n            }\r\n            // 编译元素节点\r\n            else if (type === 1) {\r\n                // 如果有子节点则先放入递归\r\n                if (node && node.children.length > 0) this.compile(node);\r\n                // 处理 input 或 textarea 中的 v-model\r\n                if (node.hasAttribute('v-model') && (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA')) {\r\n                    node.addEventListener('input', (() => {\r\n                        let key = node.getAttribute('v-model').trim();\r\n                        // 加入该项至监听队列\r\n                        this.vm.binding.addSub(new Watcher(node, 'value', data, key));\r\n                        // 删除该项属性\r\n                        node.removeAttribute('v-model');\r\n                        // 修改值\r\n                        return () => {\r\n                            data[key] = node.value;\r\n                        }\r\n                    })());\r\n                }\r\n                // 处理 v-html \r\n                if (node.hasAttribute('v-html')) {\r\n                    let key = node.getAttribute('v-html').trim();\r\n                    this.vm.binding.addSub(new Watcher(node, 'innerHTML', data, key))\r\n                    node.removeAttribute('v-html');\r\n                }\r\n                // 处理点击事件 onClick || @click || onTap || @tap\r\n                if (node.hasAttribute('onClick') || node.hasAttribute('@click')) {\r\n                    const methods = vm.$options.methods;\r\n                    if (!methods) return;\r\n                    let key = node.getAttribute('onClick') || node.getAttribute('@click');\r\n                    // 转发至对应处理方法\r\n                    let method = methods[key].bind(data);\r\n                    // 绑定点击事件\r\n                    node.addEventListener('click', method);\r\n                    // 删除对应的属性\r\n                    node.hasAttribute('onClick') && node.removeAttribute('onClick');\r\n                    node.hasAttribute('@click') && node.removeAttribute('@click');\r\n                }\r\n                this.compileText(node, 'innerHTML');\r\n            }\r\n        })\r\n    }\r\n    // 编译文字节点\r\n    compileText(node, type) {\r\n        let vm = this.vm;\r\n        let txt = node.textContent;\r\n        let data = vm._data;\r\n        let reg = /\\{\\{(.*?)\\}\\}/g;\r\n        // 存放该节点下的键值数组\r\n        let valueArr = [];\r\n        // 编译双花括号\r\n        if (reg.test(txt)) {\r\n            // 将原 HTML 中的花括号写法替换\r\n            node.innerHTML = txt.replace(reg, (matched, value) => {\r\n                // node.textContent = txt.replace(reg, (matched, value) => {\r\n                valueArr.push(value.trim())\r\n                // 返回对应值\r\n                // value 是正则第一个括号匹配到的子串\r\n                if (value.split('.').length > 1) {\r\n                    let v = null;\r\n                    // 返回花括号中的属性的值\r\n                    value.split('.').forEach((val, i) => {\r\n                        v = !v ? vm[val] : v[val];\r\n                    })\r\n                    return `<span myvue>${v}</span>`;\r\n                } else {\r\n                    return `<span myvue>${data[value.trim()]}</span>`;\r\n                }\r\n            })\r\n            // 过滤出新编译进去的元素\r\n            let tArr = [];\r\n            node.childNodes.forEach((item) => {\r\n                // 判断是否为双向绑定编译后的标签\r\n                if (item.nodeType === 1 && item.hasAttribute('myvue')) tArr.push(item);\r\n            })\r\n            // 放置监听\r\n            // 订阅花括号包裹内容\r\n            tArr.forEach((item, index) => {\r\n                this.vm.binding.addSub(new Watcher(item, type, data, valueArr[index]))\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nexport default Compile","// 全部函数\r\nimport Binding from './Binding'\r\nimport Compile from './Compile'\r\n// import { createComputed, createMounted } from './lifecycle'\r\n\r\nclass myVue3 {\r\n    // 初始化\r\n    constructor(options = {}) {\r\n        // 保留配置项\r\n        this.$options = options;\r\n        // 获取数据\r\n        let data = this._data = this.$options.data;\r\n        // 初始化监听数组\r\n        this.binding = new Binding();\r\n        // 订阅数据\r\n        this._data = this.observe.call(this, data);\r\n        // 初始化计算属性\r\n        // createComputed.call(this);\r\n        // 编译 DOM 中的 Vue 语法元素\r\n        new Compile(options.el, this)\r\n    }\r\n    // 双向绑定订阅数据\r\n    observe(data) {\r\n        const that = this;\r\n        // 如果不存在或不是对象则返回原数据\r\n        if (!data || typeof data !== 'object') return data;\r\n        // 否则加入订阅\r\n        return new Proxy(data, {\r\n            get: (target, prop) => {\r\n                return Reflect.get(target, prop);\r\n            },\r\n            set: (target, prop, value) => {\r\n                // 更新对应数据\r\n                let result = Reflect.set(target, prop, value);\r\n                // 发布订阅\r\n                that.binding.subs[prop].forEach(item => {\r\n                    item.update();\r\n                });\r\n                return result;\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nexport default myVue3;","import myVue3 from \"./myVue.js\"\r\n\r\nnew myVue3({\r\n    el: '#app',\r\n    data: {\r\n        count: 0,\r\n        other: 10\r\n    },\r\n    methods: {\r\n        changeCount() {\r\n            console.log('值增加啦');\r\n            this.count++;\r\n        },\r\n        changeOther() {\r\n            console.log('值减少啦')\r\n            this.other--;\r\n        }\r\n    }\r\n})\r\n"]}